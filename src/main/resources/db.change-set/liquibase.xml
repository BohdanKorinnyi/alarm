<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="1519975980041" author="bkorinnyi">
        <createTable tableName="client">
            <column name="id" type="bigserial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(128)"/>
            <column name="full_name" type="varchar(128)"/>
            <column name="proof" type="varchar(64)"/>
            <column name="registered" type="DATETIME"/>
        </createTable>
    </changeSet>

    <changeSet id="1519976556684" author="bkorinnyi">
        <createTable tableName="accept_rule">
            <column name="id" type="bigserial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="client_id" type="int"/>
            <column name="fact_proof" type="varchar(128)"/>
            <column name="creation" type="DATETIME" defaultValue="now()"/>
        </createTable>
    </changeSet>

    <changeSet id="1519977754798" author="bkorinnyi">
        <createTable tableName="call_number">
            <column name="id" type="bigserial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="client_id" type="int"/>
            <column name="creation" type="DATETIME" defaultValue="now()"/>
            <column name="number" type="varchar(32)"/>
        </createTable>
    </changeSet>

    <changeSet id="1519977807044" author="bkorinnyi">
        <createTable tableName="alarm">
            <column name="id" type="bigserial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="client_id" type="int"/>
            <column name="voice" type="varchar(1024)"/>
            <column name="proof_voice" type="varchar(1024)"/>
            <column name="message" type="varchar(1024)"/>
            <column name="creation" type="DATETIME" defaultValue="now()"/>
        </createTable>
    </changeSet>

    <changeSet id="1519978191419" author="bkorinnyi">
        <createTable tableName="call">
            <column name="id" type="bigserial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="client_id" type="int"/>
            <column name="reason" type="varchar(32)"/>
            <column name="date" type="DATETIME" defaultValue="now()"/>
            <column name="provider" type="varchar(32)"/>
            <column name="call_number_id" type="int"/>
            <column name="status" type="varchar(32)"/>
            <column name="listened_full" type="boolean"/>
            <column name="duration" type="int"/>
            <column name="cost" type="DOUBLE PRECISION"/>
        </createTable>
    </changeSet>

    <changeSet id="1519978191420" author="bkorinnyi">
        <addForeignKeyConstraint baseColumnNames="client_id"
                                 baseTableName="accept_rule"
                                 constraintName="fk_accept_rule_client"
                                 deferrable="true"
                                 initiallyDeferred="true"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="client"/>
    </changeSet>
    <changeSet id="1519978191421" author="bkorinnyi">
        <addForeignKeyConstraint baseColumnNames="client_id"
                                 baseTableName="call_number"
                                 constraintName="fk_call_number_client"
                                 deferrable="true"
                                 initiallyDeferred="true"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="client"/>
    </changeSet>
    <changeSet id="1519978191422" author="bkorinnyi">
        <addForeignKeyConstraint baseColumnNames="client_id"
                                 baseTableName="alarm"
                                 constraintName="fk_alarm_client"
                                 deferrable="true"
                                 initiallyDeferred="true"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="client"/>
    </changeSet>
    <changeSet id="1519978191423" author="bkorinnyi">
        <addForeignKeyConstraint baseColumnNames="client_id"
                                 baseTableName="call"
                                 constraintName="fk_call_client"
                                 deferrable="true"
                                 initiallyDeferred="true"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="client"/>
    </changeSet>
    <changeSet id="1520105646538" author="bkorinnyi">
        <dropColumn tableName="client" columnName="name"/>
        <dropColumn tableName="client" columnName="full_name"/>
        <dropColumn tableName="alarm" columnName="proof_voice"/>
        <dropColumn tableName="alarm" columnName="voice"/>
        <dropColumn tableName="alarm" columnName="message"/>
        <dropColumn tableName="call" columnName="date"/>
        <addColumn tableName="client">
            <column name="first_name" type="varchar(64)"/>
            <column name="last_name" type="varchar(128)"/>
        </addColumn>
        <addColumn tableName="alarm">
            <column name="name_record" type="varchar(128)"/>
            <column name="address_record" type="varchar(128)"/>
            <column name="type" type="varchar(32)"/>
            <column name="active" type="boolean"/>
        </addColumn>
        <addColumn tableName="call">
            <column name="created" type="DATETIME"/>
            <column name="updated" type="DATETIME"/>
        </addColumn>
        <addColumn tableName="client">
            <column name="updated" type="DATETIME"/>
        </addColumn>
        <modifyDataType tableName="client" columnName="proof" newDataType="boolean"/>
    </changeSet>
    <changeSet id="1520105646540" author="bkorinnyi">
        <addForeignKeyConstraint baseColumnNames="call_number_id"
                                 baseTableName="call"
                                 constraintName="fk_call_call_number"
                                 deferrable="true"
                                 initiallyDeferred="true"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="call_number"/>
    </changeSet>
    <changeSet id="1520105646545" author="bkorinnyi">
        <dropTable tableName="accept_rule"/>
    </changeSet>
    <changeSet id="1520253608370" author="bkorinnyi">
        <modifyDataType tableName="alarm" columnName="client_id" newDataType="BIGINT"/>
        <modifyDataType tableName="call" columnName="client_id" newDataType="BIGINT"/>
        <modifyDataType tableName="call" columnName="call_number_id" newDataType="BIGINT"/>
        <modifyDataType tableName="call_number" columnName="client_id" newDataType="BIGINT"/>
    </changeSet>
    <changeSet id="1520368218842" author="bkorinnyi">
        <addColumn tableName="call_number">
            <column name="active" type="boolean"/>
        </addColumn>
        <addColumn tableName="call">
            <column name="alarm_id" type="bigint"/>
            <column name="call_reason_id" type="bigint"/>
            <column name="call_status_id" type="bigint"/>
        </addColumn>
        <dropColumn tableName="call" columnName="client_id"/>
        <dropColumn tableName="call" columnName="reason"/>
        <dropColumn tableName="call" columnName="status"/>
    </changeSet>
    <changeSet id="1520368537937" author="bkorinnyi">
        <createTable tableName="call_reason">
            <column name="id" type="bigserial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="value" type="varchar(64)"/>
        </createTable>
        <createTable tableName="call_status">
            <column name="id" type="bigserial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="value" type="varchar(64)"/>
        </createTable>
    </changeSet>
    <changeSet id="1520368918235" author="bkorinnyi">
        <addForeignKeyConstraint baseColumnNames="alarm_id"
                                 baseTableName="call"
                                 constraintName="fk_call_alarm"
                                 deferrable="true"
                                 initiallyDeferred="true"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="alarm"/>
        <addForeignKeyConstraint baseColumnNames="call_reason_id"
                                 baseTableName="call"
                                 constraintName="fk_call_call_reason"
                                 deferrable="true"
                                 initiallyDeferred="true"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="call_reason"/>
        <addForeignKeyConstraint baseColumnNames="call_status_id"
                                 baseTableName="call"
                                 constraintName="fk_call_call_status"
                                 deferrable="true"
                                 initiallyDeferred="true"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="call_status"/>
    </changeSet>
    <changeSet id="1520376853849" author="bkorinnyi">
        <addDefaultValue tableName="client" columnName="registered" defaultValue="now()"/>
    </changeSet>
    <changeSet id="1520608006338" author="vkarpushchenko">
        <dropColumn tableName="client" columnName="registered"/>
        <addColumn tableName="client">
            <column name="registered" type="DATETIME" defaultValue="now()"/>
        </addColumn>
    </changeSet>
    <changeSet id="1520664140745" author="vkarpushchenko">
        <dropColumn tableName="call" columnName="created"/>
        <addColumn tableName="call">
            <column name="creation" type="DATETIME" defaultValue="now()"/>
        </addColumn>
        <addColumn tableName="client">
            <column name="external_id" type="VARCHAR(128)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="1521063619784" author="vkarpushchenko">
        <addNotNullConstraint columnName="registered" tableName="client"/>
        <dropColumn columnName="call_reason_id" tableName="call"/>
        <dropTable tableName="call_reason"/>
    </changeSet>
    <changeSet id="1522019887377" author="bkorinnyi">
        <insert tableName="call_status">
            <column name="id" value="1"></column>
            <column name="value" value="created"></column>
        </insert>
        <insert tableName="call_status">
            <column name="id" value="2"></column>
            <column name="value" value="queued"></column>
        </insert>
        <insert tableName="call_status">
            <column name="id" value="3"></column>
            <column name="value" value="in-progress"></column>
        </insert>
        <insert tableName="call_status">
            <column name="id" value="4"></column>
            <column name="value" value="completed"></column>
        </insert>
        <insert tableName="call_status">
            <column name="id" value="5"></column>
            <column name="value" value="busy"></column>
        </insert>
        <insert tableName="call_status">
            <column name="id" value="6"></column>
            <column name="value" value="failed"></column>
        </insert>
        <insert tableName="call_status">
            <column name="id" value="7"></column>
            <column name="value" value="no-answer"></column>
        </insert>
        <insert tableName="call_status">
            <column name="id" value="8"></column>
            <column name="value" value="canceled"></column>
        </insert>
    </changeSet>
    <changeSet id="1522019887380" author="bkorinnyi">
        <addColumn tableName="call">
            <column name="provider_id" type="varchar(128)"></column>
        </addColumn>
    </changeSet>
    <changeSet id="1522019887388" author="bkorinnyi">
        <insert tableName="call_status">
            <column name="id" value="9"></column>
            <column name="value" value="ringing"></column>
        </insert>
    </changeSet>
    <changeSet id="1522430542842" author="bkorinnyi">
        <createTable tableName="languages">
            <column name="id" type="serial">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="code" type="varchar(8)"></column>
            <column name="name" type="varchar(32)"></column>
        </createTable>
        <insert tableName="languages">
            <column name="code" value="en-US"></column>
            <column name="name" value="English"></column>
        </insert>
    </changeSet>
    <changeSet id="1522430857330" author="bkorinnyi">
        <addColumn tableName="alarm">
            <column name="language_id" type="int" defaultValue="1">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="1522503655818" author="bkorinnyi">
        <addColumn tableName="languages">
            <column name="intro" type="varchar(256)"/>
        </addColumn>
    </changeSet>
    <changeSet id="1523918256318" author="bkorinnyi">
        <addColumn tableName="alarmCall">
            <column name="parent_id" type="bigint"/>
        </addColumn>
    </changeSet>
</databaseChangeLog>